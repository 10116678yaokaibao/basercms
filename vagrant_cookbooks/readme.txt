================================================================================
Vagrant環境でのbaserCMSの利用方法
================================================================================

Vagrantを利用することで、得にサーバ設定等を行うことなく、ローカル内のVM環境で
baserCMSをテスト・開発することが出来ます。


----------------------------------------
■動作確認環境
----------------------------------------

・Vagrant 1.3.1
・VirtualBox 4.2.18
・Mac OSX 10.9

※VagrantとVirtualBoxはバージョン依存が大きいため、できる限り近いバージョンでの
　利用をお勧めします。
※Windowsでの実行もおそらく可能です


----------------------------------------
■起動方法
----------------------------------------

「Vagrantfile」のあるディレクトリ内で、次のコマンドを実行してください。

$ vagrant up

※初回の実行では、自動的にVMのセットアップが行われます。この際に、ベースとなる
　VMイメージのダウンロードと必要なアプリケーションのインストール・更新が
　おこなわれるため、モバイルなどネット帯域の狭い環境ですと大変に時間が
　かかります。できる限りネット環境の良いところで実行してください。


----------------------------------------
■環境の更新方法
----------------------------------------

もしbasercmsリポジトリ内で「Vagrantfile」もしくは「vagrant_cookbooks」が
更新された場合は、次のコマンドを実行してください。

$ vagrant provision


----------------------------------------
■VM環境の操作方法
----------------------------------------

Vagrantの使い方を簡単に説明します。
詳しくはVagrantの公式サイトをご覧ください。(http://www.vagrantup.com/)

・起動
$ vagrant up

・停止
$ vagrant halt

・再起動
$ vagrant reload

・サスペンド
$ vagrant suspend

・(サスペンドからの)復帰
$ vagrant resume

・ステータス
$ vagrant status

・サーバ内にSSH接続
$ vagrant ssh

・VM環境の更新
$ vagrant provision

・VM破棄(リポジトリ内のファイルが無くなるわけではないので注意)
$ vagrant destroy


----------------------------------------
■VM環境
----------------------------------------

・CentOS 6.4
・Apache2.2
・MySQL5.5
・PostgreSQL8.4
・PHP5.4

※基本的にyumで最新バージョンがインストールされます


----------------------------------------
■パスワード関連
----------------------------------------

「vagrant ssh」内でスーパバイザになる場合や、データベースのアクセス、
baserCMSの設定には次のユーザとパスワードを利用します。
なお、初期データベースはvagrant upで作成されます。

・root
pass : vagrant

・MySQL
database : basercms
user     : root
pass     : root

・PostgreSQL
database : basercms
user     : postgres
pass     : postgres


----------------------------------------
■baserCMS等のアクセス方法
----------------------------------------

URLは下記になります。

・baserCMS
http://127.0.0.1:8080/

・phpMyAdmin
http://127.0.0.1:8080/phpMyAdmin/

・phpPgAdmin
http://127.0.0.1:8080/phpPgAdmin/


----------------------------------------
■共有フォルダについて
----------------------------------------

Vagrantでは、VMとローカル側で共有フォルダを構成しており、VM内にファイルを
アップロードしなくてもリアルタイムにファイルの共有が行われています。


----------------------------------------
■注意事項
----------------------------------------

baserCMS一式を公開サーバにアップロードする場合は、必ず「Vagrantfile」
「vagrant_cookbooks/」「.vagrant/」を除外してください。

httpdに関して、毎分起動監視を行っており、サービスが停止している場合は毎回
「service httpd start」を試みます。これは初回インストール以降「vagrant up」
あるいは「vagrant reload」を行うと共有フォルダのマウントがhttpdの自動起動の
後に行われる影響でデーモンの起動エラーとなるためです。意図的にhttpdを停止
したい場合はcronを停止してください。

インストールモード時のTOP(http://127.0.0.1:8080/)が乱れることがあります。
現象としては、JS/CSSファイルが一部欠落してしまうようです。
原因は特定できていませんが、PHPからの共有フォルダへのアクセスが間に合って
いない可能性があります。
このため暫定的に「php-pecl-apc」を外しています。必要な場合は手動で入れて
ください。
